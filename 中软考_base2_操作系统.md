## 操作系统

### 1. 进程管理

#### 1.1 进程的状态

​		进程是程序在一个数据集合上运行的过程，它是系统进行资源分配和调度的一个独立单位。它由**程序块、进程控制块（PCB）和数据块**三部分组成

进程与程序的区别

- 进程是程序的一次执行过程，没有程序就没有进程。
- 程序是完成某个特定功能的一系列程序语句的集合，只要不被破坏，它就永远存在。
- 程序是一个静态的概念，而进程是一个动态的概念，它由创建而产生，完成任务后因撤销而消亡；
- 进程是系统进行资源分配和调度的独立单位，而程序不是。



#### 1.2 进程状态图

![1571143488543](.\image\1571143488543.png)

运行到就绪：CPU时间片用完，进程的优先级低（释放资源给高优先级用）

人为挂起：会产生静止就绪、静止阻塞（等待）状态



#### 1.3 进程的同步与互斥

- 直接制约关系（同步）
- 间接制约关系（互斥，争夺临界资源）
- 临界资源（独木桥）

![1571152810615](.\image\1571152810615.png)



#### 1.4 PV 操作

p是申请资源的操作，v是释放资源的操作。

- 临界资源：诸进程间需要互斥方式对其进行共享的资源，如打印机、滋带机等
- 临界区：每个进程中访问临界资源的那段代码称为临界区
- 信号量：是一种特殊的变量
- P是荷兰语的Passeren，V是荷兰语的Verhoog。

![1571144016939](.\image\1571144016939.png)

多个进程共享一台打印机问题（**互斥横型**）：

![1571144122625](.\image\1571144122625.png)

单缓冲区生产者、消费者问题（**同步模型**）：

![1571144334457](.\image\1571144334457.png)



#### 1.5 PV操作应用

​		某书店有一个收银员，该书店最多允许n个购书者进入。将收银员和购书者看作不同的进程，其工作流程如下图所示。利用PV操作实现该过程，设置信号量S1、S2和Sn，初值分别为0，0，n.则图中al和a2应填入V(S1)P(S2)，图中b1和b2应填入P(S1)V(S2)。

![1571144523920](.\image\1571144523920.png)

![1571146617684](.\image\1571146617684.png)

A：绞肉
B：切葱末
C：切姜末
D：搅拌（入度）
E：包饺子

~~~
Sa=0；Sb=0；Sc=0；Sd=0；
进程A：绞肉；V（Sa）；
进程B：切葱末；V（Sb）；
进程C：切菱末；V（Sc）；
进程D：P（Sa）；P（Sb）；P（Sc）；搅拌；V（Sd）；
进程E：P（Sd）：包饺子；
~~~



#### 1.6 死锁问题

​			进程管理是操作系统的核心，但如果设计不当，就会出现死锁的问题。如果一个进程在等待一件不可能发生的事，则进程就死锁了。而如果一个或多个进程产生死锁，就会造成系统死锁。

​		例：系统有5个进程：A、B、C、D、E。这5个进程都需要4个系统资源。如果系统至少有多少个资源，则不可能发生死锁。保险一点就20个，每一个进程都有4个资源，互不作用。至少的话就16个

![1571147161458](.\image\1571147161458.png)



#### 1.7 银行家算法-分配资源的原则

1. 当一个进程对资源的最大需求量不超过系统中的资源数时可以接纳该进程。
2. 进程可以分期请求资源，但请求的总数不能超过最大需求量。
3. 当系统现有的资源不能满足进程尚需资源数时，对进程请求可以推迟分配，但总能使进程在有限的时间里得到资源。

![1571147417399](.\image\1571147417399.png)

银行家算法例子：
		假设系统中有三类互斥资源R1、、R2、R3，可用资源分别是9、8、5。在TO时刻系统中有P1、P2、P3、P4和P5五个进程，这些进程对资源的最大需求量和已分配资源数如下所示，如果进程按序列执行，那么系统状态是安全的。

一开始计算后算出 2 1 0只有P2和P4满足条件，所以按顺序为P2，P2使用完释放已分配资源累计获得为4 2 1...

![1571147530290](.\image\1571147530290.png)

![1571147881029](.\image\1571147881029.png)



### 2. 存储管理

#### 2.1 页式存储组织

页式存储：将程序与内存均划分为同样大小的块，以页为单位将程序调入内存。

- 逻辑地址=页号+页内地址
- 物理地址=页帧号+页内地址

例如，页式存储系统中，每个页的大小为4KB。

~~~
类似下图中页号为2，快号（页帧号为6），对应10-110
逻辑地址：			 10 110011011110
对应的物理地址为：	  110 110011011110
~~~

![1571148366105](.\image\1571148366105.png)

- 优点：利用率高，碎片小，分配及管理简单
- 缺点：增加了系统开销；可能产生抖动现象

![1571148592181](.\image\1571148592181.png)

状态是为了节省内存，腾出空间（即使释放000状态的资源）



#### 2.2 段式存储组织

段式存储：按用户作业中的自然段来划分逻辑空间，然后调入内a存，段的长度可以不一样。

![1571148749882](.\image\1571148749882.png)

- 优点：多道程序共享内存，各段程序修改互不影响
- 缺点：内存利用率低，内存碎片浪费大



#### 2.3 段页式存储组织

段页式存储：段式与页式的综合体。先分段，再分页。1个程序有若干个段，每个段中可以有若干页，每个页的大小相同，但每个段的大小不同。

![1571148982493](.\image\1571148982493.png)

- 优点：空间浪费小、存储共事容易、存储保护容易、能动态连接
- 缺点：由于管理软件的增加，复杂性和开销也随之增加，需要的硬件以及占用的内容也有所增加，使得执行速度大大下降



#### 2.4 页面置换算法

- 最优（Optimal，OPT）算法
- 随机（RAND）算法
- 先进先出（FIFO）算法：有可能产生“抖动”。例如，432143543215序列，用3个页面，比4个缺页要少
- 最近最少使用（LRU）算法：不会“抖动”，LRU的理论依据是“局部性原理”。
  - 时间局部性：刚被访问的内容，立即又被访问。
  - 空间局部性：刚被访问的内容，临近的空间很快被访问。



#### 2.5 磁盘管理

![1571149301934](.\image\1571149301934.png)

~~~
存取时间=寻道时间+等待时间
~~~

寻道时间是指磁头移动到磁道所需的时间；等待时间为等待读写的扇区转到磁头下方所用的时间。



#### 2.6 磁盘调度算法

- 先来先服务（FCFS）
- 最短寻道时间优先（SSTF）
- 扫描算法（SCAN）——电梯算法
- 循环扫描（CSCAN）算法——电梯算法（单边）



#### 2.7 读取磁盘数据时间计算

读取磁盘数据的时间应包括以下三个部分：

1. 找磁道的时间。
2. 找块（扇区）的时间，即旋转延迟时间。
3. 传输时间。

​		某磁盘磁头从一个磁道移至另一个磁道需要10ms。文件在磁盘上非连续存放，逻辑上相邻数据块的平均移动距离为10个磁道，每块的旋转延迟时间及传输时间分别为100ms和2ms，则读取一个100块的文件需要_ms时间。
A.10200 B.11000 C.11200 D.20200

~~~
((10*10)+100+2)*100
~~~



### 3. 作业、文件、设备管理

#### 3.0 真题

1. 计算机运行过程中，遇到突发事件，要求 CPU 暂时停止正在运行的程序，转去为突发事件服务，服务完毕，再自动返回原程序继续执行，这个过程称为（ ），其处理过程中保存现场的目的是（ ）。
   A.阻塞  B.中断  C.动态绑定  D.静态绑定
   A.防止丢失数据  B.防止对其他部件造成影响  C.返回去继续执行原程序  D.为中断处理程序提供数据

~~~
解析:
中断是指计算机运行过程中，出现某些意外情况需主机干预时，机器能自动停止正在运行的程序并转入处理新情况的程序，处理完毕后又返回原被暂停的程序继续运行。
~~~

![1572171172218](.\image\1572171172218.png)



#### 3.1 作业状态与作业管理

![1571149954879](.\image\1571149954879.png)

主要分为：提交、后备、执行、完成



#### 3.2 作业调度算法

1. 先来先服务法
2. 时间片轮转法(CPU时间到了就换其他)
3. 短作业优先法
4. 最高优先权优先法
5. 高响应比优先法（作业等待时间/执行作业时间）



#### 3.3 索引文件结构

![1571150189331](.\image\1571150189331.png)

~~~
4B 对应 1KB
直接索引		 1024B
一级间接索引		256KB
二级间接索引		64MB
三级间接索引		16GB
~~~



#### 3.4 索引文件结构

![1571151488047](.\image\1571151488047.png)

266kb



#### 3.5 树型目录结构

![1571151582528](.\image\1571151582528.png)

~~~
已知D1和F2,查找F2的相对路径：./W2/F2，绝对路径为/D1/W2/F2
~~~



#### 3.6 空闲存储空间的管理

位示图法

![1571151749146](.\image\1571151749146.png)

~~~
求容量？？
~~~



#### 3.7 数据传输控制方式

（1->5，效率越来越高）

1. 程序控制（查询）方式：分为无条件传送和程序查询方式两种。方法简单，硬件开销小，但I/O能力不高，严重影响CPU的利用率。
2. 程序中断方式：与程序控制方式相比，中断方式因为CPU无需等待而提高了传输请求的响应速度。
3. DMA方式：DMA方式是为了在主存与外设之间实现高速、批量数据交换而设置的。DMA方式比程序控制方式与中断方式都高效。（不影响CPU，所有操作都由硬件来完成）
4. 通道方式：感觉是VPN一样
5. I/O处理机：IOP



#### 3.8 虚设备与SPOOLING技术

​		（类似队列）SPOOLing是关于慢速字符设备如何与计算机主机交换信息的一种技术，通常称为“假脱机技术”。SPOOLing技术通过磁盘实现。

![1571152205313](.\image\1571152205313.png)











